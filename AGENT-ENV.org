#+title: Agent Environment Notes
#+date: 2025-11-27T19:58:50.863747-08:00
#+author: Codex

* Shell & Quoting
- Default shell: PowerShell (pwsh) with escape char backtick (`). Use here-strings for multi-line snippets and double-up quotes when embedding JSON/YAML.
- Inline Python via `python -c` works well; for complex scripts assign to a Here-String, like `$py = @'... '@` and pass to python to avoid escaping ${{ }} tokens.
- `apply_patch` is fragile under PowerShell quoting; prefer Python-based rewrites or `sd`/`rg` edits when workflows contain GitHub expressions.

* Preferred Tools
- File search: `fd` (installed) or `rg <pattern>` for fast content search.
- Diffing: `D:/scoop/shims/diff.exe` exposes GNU diffutils 2.8.7 when Git porcelain lacks needed flags.
- HTML/text munging per operator guidance: combine `hq`, `jq`, `rg`, `sd`, and `pandoc` as needed.

* Git Environment
- Git version 2.52.0.windows.1 is available; some historic flags (e.g., `--no-ext-diff`) are unsupported, so stick to standard porcelain or external `diff.exe`.
- Repo root: `D:/code/fork/daktilo-tray` with danger-full-access sandbox; no restrictions on scripts touching subpaths.
- `git diff --numstat HEAD` intermittently fails; fall back to `git diff --cached --numstat` or explicit file arguments.

* Python Toolchain
- CPython 3.11.4 reachable as `python`; always pass `encoding='utf-8'` when reading/writing org documents to avoid Windows-1252 decoding errors.
- Multi-line scripts should use here-strings piped into python to avoid PowerShell interpreting braces/quotes.

* PowerShell Idioms
- Use `Add-Content -Path ... -Value ... -Encoding UTF8` for org logs; prefer Python when tailing large UTF-8 files because `Get-Content -Tail` can hang.
- `Set-PSDebug -Trace 1` reveals release scripts source `./scripts/common-dist.ps1`; import helpers via `. (Join-Path ...)` before invoking.
- Remember escape char is backtick; nested double quotes must be `"` or wrapped in single quotes when invoking commands.

* Release/Signing Context
- `signtool.exe` lives under `C:/Program Files (x86)/Windows Kits/10/App Certification Kit/signtool.exe`; helpers also honor `SIGNTOOL_PATH` env var.
- Channel metadata in `dist-workspace.toml` defines store/location/subject/thumbprint plus auto-provision modes (self-signed vs ACME via Caddy/Cloudflare).

* CI/Automation Reminders
- Always append timestamped entries to `WORK.org` (ISO8601 with timezone) describing plans/actions.
- Run `cargo build` before finishing tasks; capture existing warnings (e.g., `audio-tests` cfg, missing docs) for operator awareness.
- When updating release automation, run `dist init --yes`/`dist generate`, then re-layer cargo-pants, signtool, and installer smoke hooks.

* Troubleshooting Notes
- `git diff --stat` sometimes prints nothing even with staged files; confirm via `git status -sb`.
- If `Add-Content` reports "pipe is being closed", rerun with explicit `-Path` and longer timeout.
- Prefer Python editing when workflows contain ${{ }} expressions so PowerShell doesn't misinterpret braces.

* References
- `AGENTS.md` owns coding/build conventions; this document records environment + tooling quirks for agents.

# EOF
